pipeline {
  agent any

  environment {
    PLAYWRIGHT_BROWSERS_PATH = "${WORKSPACE}\\pw-browsers"
  }

  stages {
    stage('Checkout') {
      steps {
        git branch: 'main', url: 'https://github.com/Anilgowda88/Playwright.git'
      }
    }

    stage('Install Dependencies') {
      steps {
        bat 'npm ci'
        bat 'npx playwright install --with-deps'
      }
    }
    stage('Install Playwright Browsers') {
      steps {
        // Ensures Chromium, Firefox, WebKit are downloaded for Jenkins SYSTEM user
        bat 'npx playwright install --with-deps'
      }
    }
stage('Install Playwright Browsers') {
  steps {
    bat 'set PLAYWRIGHT_BROWSERS_PATH=%WORKSPACE%\\pw-browsers && npx playwright install --with-deps'
  }
}

    stage('Run Playwright Tests') {
      steps {
        bat 'npx playwright test --reporter=line'
      }
    }

    stage('Archive Reports & Artifacts') {
      steps {
        // Archive Playwright HTML report
        archiveArtifacts artifacts: 'playwright-report/**', fingerprint: true

        // Archive test results (screenshots, videos, traces)
        archiveArtifacts artifacts: 'test-results/**', fingerprint: true
      }
    }
  }

  post {
    always {
      echo 'Pipeline finished. Reports and artifacts archived.'
    }
    failure {
      echo 'Tests failed. Check artifacts for debugging.'
    }
  }
}
